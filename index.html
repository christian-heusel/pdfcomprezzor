<html>
<head>
<meta charset="utf-8">
<script src="wasm_exec.js"></script>
<script>

downloadBlob = function(data, fileName, mimeType) {
  var blob, url;
  blob = new Blob([data], {
    type: mimeType
  });
  url = window.URL.createObjectURL(blob);
  downloadURL(url, fileName);
  setTimeout(function() {
    return window.URL.revokeObjectURL(url);
  }, 1000);
};

downloadURL = function(data, fileName) {
  var a;
  a = document.createElement('a');
  a.href = data;
  a.download = fileName;
  document.body.appendChild(a);
  a.style = 'display: none';
  a.click();
  a.remove();
};
    if (!WebAssembly.instantiateStreaming) { // polyfill
        WebAssembly.instantiateStreaming = async (resp, importObject) => {
            const source = await (await resp).arrayBuffer()
            return await WebAssembly.instantiate(source, importObject)
        }
    }
    const go = new Go();
    WebAssembly.instantiateStreaming(fetch("pdfcomprezzor.wasm"), go.importObject).then((result) => {
        go.run(result.instance);
    });
    function fn () {
    document.querySelector('input').addEventListener('change', function() {
    var array;
  var reader = new FileReader();
  reader.onload = function() {

    var arrayBuffer = this.result;
    array = new Uint8Array(arrayBuffer);
    console.log(array);
    var l={l:0};
    console.log(loadImage(array,l));
    result = array.slice(0,l.l);
    console.log(l);
    downloadBlob(result,"smaller.pdf","application/pdf");
  }
  reader.readAsArrayBuffer(this.files[0]);

}, false);
}
document.addEventListener('DOMContentLoaded', fn, false);
</script>
</head>
<body>
<input type="file" />
<div id="result"></div></body>
</html>